<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Noofolio ‚Äì Your Work, Not Your Role{% endblock %}</title>
    <link rel="icon" type="image/png" href="/static/assets/icon_white.png">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    {% block extra_head %}{% endblock %}
</head>
<body>
    {% block navbar %}
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand" style="display: flex; align-items: center;">
                <img src="/static/assets/nav_logo_white.png" alt="Noofolio" style="height: 32px;">
            </a>
            <div class="nav-links">
                <a href="/">üè† Home</a>
                <a href="/onboarding">‚ú® Crea</a>
                <a href="/explore">üìÅ Esplora</a>
                <a href="/dashboard/marco_rossi">üìã Il mio Noofolio</a>
                <a href="/demo-settings">‚öôÔ∏è Impostazioni Demo</a>
                <div class="user-dropdown" style="position: relative;">
                    <button class="user-button" id="user-button" onclick="toggleUserMenu()" style="background: var(--bg-card); border: 1px solid var(--border); padding: 0.5rem 1rem; border-radius: 8px; color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                        üë§ <span id="navbar-username">Marco Rossi</span>
                        <span style="font-size: 0.7rem;">‚ñº</span>
                    </button>
                    <div id="user-menu" class="user-menu" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; min-width: 200px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000;">
                        <a href="#" id="user-menu-dashboard" style="display: block; padding: 0.75rem 1rem; color: var(--text); text-decoration: none; border-bottom: 1px solid var(--border);">üìã Il mio Noofolio</a>
                        <a href="/select-profile" style="display: block; padding: 0.75rem 1rem; color: var(--text); text-decoration: none;">üîÑ Cambia utente</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    {% endblock %}

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    {% block footer %}
    <footer class="footer">
        <p>Generated by <strong>Noofolio</strong> ‚Äì Your work, not your role.</p>
        <p class="footer-sub">From the noosphere: decisions, judgment, and proof.</p>
    </footer>
    {% endblock %}

    {% block extra_scripts %}{% endblock %}

    <script>
    function toggleUserMenu() {
        const menu = document.getElementById('user-menu');
        menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const dropdown = document.querySelector('.user-dropdown');
        if (dropdown && !dropdown.contains(event.target)) {
            document.getElementById('user-menu').style.display = 'none';
        }
    });

    // Initialize user on page load
    document.addEventListener('DOMContentLoaded', function() {
        const currentUser = sessionStorage.getItem('current_user') || 'Marco Rossi';
        const currentUserId = sessionStorage.getItem('current_user_id') || 'marco_rossi';

        updateNavbarUser(currentUser, currentUserId);

        // Save default user if not set
        if (!sessionStorage.getItem('current_user')) {
            sessionStorage.setItem('current_user', 'Marco Rossi');
            sessionStorage.setItem('current_user_id', 'marco_rossi');
        }
    });

    // Listen for user changes
    window.addEventListener('userChanged', function(e) {
        const userName = e.detail.userName;
        const userId = e.detail.userId || userName.toLowerCase().replace(/ /g, '_');
        updateNavbarUser(userName, userId);
    });

    function updateNavbarUser(userName, userId) {
        document.getElementById('navbar-username').textContent = userName;

        // Update dashboard link
        const dashboardLink = document.getElementById('user-menu-dashboard');
        if (userId !== 'nuovo_utente') {
            dashboardLink.href = '/dashboard/' + userId;
            dashboardLink.style.display = 'block';
        } else {
            dashboardLink.style.display = 'none';
        }

        // Update nav link
        const navDashboardLink = document.querySelector('a[href^="/dashboard/"]');
        if (navDashboardLink && userId !== 'nuovo_utente') {
            navDashboardLink.href = '/dashboard/' + userId;
        }
    }
    </script>
</body>
</html>