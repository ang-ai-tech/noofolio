{% extends "base.html" %}

{% block content %}
<div class="step-container">
    <!-- Progress indicator -->
    <div class="progress-container">
        <span class="progress-label">Step {{ step }}/{{ total_steps }}</span>
        {% for i in range(1, total_steps + 1) %}
        <span class="progress-step {% if i < step %}completed{% elif i == step %}active{% else %}pending{% endif %}">
            {{ i }}
        </span>
        {% endfor %}
    </div>

    {% if step == 1 %}
    <!-- Step 1: Chi Sei -->
    <h2 class="step-header">ğŸ“‹ Step 1: Chi Sei</h2>
    
    <div class="encouragement-box">
        <h4>âœ¨ Prima di iniziare...</h4>
        <p>Ci vorrÃ  pazienza ma ne varrÃ  la pena. I recruiter potranno chattare col tuo profilo.</p>
    </div>
    
    <form hx-post="/create/step/1" hx-target="main" hx-swap="innerHTML" enctype="multipart/form-data">
        <div class="form-row">
            <div class="form-group">
                <label for="nome">Nome *</label>
                <input type="text" name="nome" id="nome" required value="{{ data.get('nome', '') }}">
            </div>
            <div class="form-group">
                <label for="cognome">Cognome *</label>
                <input type="text" name="cognome" id="cognome" required value="{{ data.get('cognome', '') }}">
            </div>
        </div>
        
        <!-- CV Section with 3 options -->
        <div class="form-group">
            <label>ğŸ“„ CV / Background *</label>
            <div class="cv-options" style="margin-top: 0.5rem;">
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="upload" onchange="toggleCVInput('upload')">
                        <span>Allega file (PDF/Word)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="link" onchange="toggleCVInput('link')">
                        <span>Link condiviso</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="text" checked onchange="toggleCVInput('text')">
                        <span>Incolla testo</span>
                    </label>
                </div>
                
                <div id="cv-upload" style="display: none;">
                    <input type="file" name="cv_file" accept=".pdf,.doc,.docx" 
                           style="padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); width: 100%;">
                    <p class="form-help">Formati supportati: PDF, Word (.doc, .docx)</p>
                </div>
                
                <div id="cv-link" style="display: none;">
                    <input type="url" name="cv_link" placeholder="https://drive.google.com/... o OneDrive/Dropbox link"
                           style="width: 100%; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <p class="form-help">Link condiviso da Google Drive, OneDrive, Dropbox, ecc.</p>
                </div>
                
                <div id="cv-text" style="display: block;">
                    <textarea name="cv_content" rows="8" required 
                              placeholder="Incolla qui il testo del tuo CV o descrivi il tuo background professionale...">{{ data.get('cv_content', '') }}</textarea>
                </div>
            </div>
        </div>
        
        <!-- Links Section (Dynamic) -->
        <div class="form-group">
            <label>ğŸ”— Link professionali</label>
            <p class="form-help">Aggiungi LinkedIn, GitHub, Behance, Articoli, Portfolio, ecc.</p>
            
            <div id="links-container">
                <!-- Default 2 rows -->
                <div class="link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="url" name="link_url[]" placeholder="https://linkedin.com/in/..." 
                           style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <select name="link_type[]" 
                            style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="GitHub">GitHub</option>
                        <option value="Behance">Behance</option>
                        <option value="Articolo">Articolo</option>
                        <option value="Altro">Altro</option>
                    </select>
                    <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
                </div>
                
                <div class="link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="url" name="link_url[]" placeholder="https://github.com/..." 
                           style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <select name="link_type[]" 
                            style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="GitHub" selected>GitHub</option>
                        <option value="Behance">Behance</option>
                        <option value="Articolo">Articolo</option>
                        <option value="Altro">Altro</option>
                    </select>
                    <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
                </div>
            </div>
            
            <button type="button" onclick="addLink()" class="btn btn-secondary" style="margin-top: 0.5rem;">
                â• Aggiungi link
            </button>
        </div>
        
        <div class="form-group">
            <label for="superpotere">âš¡ Superpotere</label>
            <textarea name="superpotere" id="superpotere" rows="3" 
                      placeholder='Es: "Sono quello che trova il bug impossibile"'>{{ data.get('superpotere', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="presentazione">ğŸ’¬ Presentazione</label>
            <textarea name="presentazione" id="presentazione" rows="3">{{ data.get('presentazione', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <a href="/" class="btn btn-secondary">â† Home</a>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>
    
    <script>
    function toggleCVInput(type) {
        document.getElementById('cv-upload').style.display = type === 'upload' ? 'block' : 'none';
        document.getElementById('cv-link').style.display = type === 'link' ? 'block' : 'none';
        document.getElementById('cv-text').style.display = type === 'text' ? 'block' : 'none';
    }
    
    function addLink() {
        const container = document.getElementById('links-container');
        const newRow = document.createElement('div');
        newRow.className = 'link-row';
        newRow.style.cssText = 'display: flex; gap: 0.5rem; margin-bottom: 0.5rem;';
        newRow.innerHTML = `
            <input type="url" name="link_url[]" placeholder="https://..." 
                   style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
            <select name="link_type[]" 
                    style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                <option value="LinkedIn">LinkedIn</option>
                <option value="GitHub">GitHub</option>
                <option value="Behance">Behance</option>
                <option value="Articolo">Articolo</option>
                <option value="Altro">Altro</option>
            </select>
            <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
        `;
        container.appendChild(newRow);
    }
    
    function removeLink(button) {
        button.parentElement.remove();
    }
    </script>

    {% elif step == 2 %}
    <!-- Step 2: Decision Log -->
    <h2 class="step-header">ğŸŒ³ Step 2: Decision Log</h2>
    
    <form hx-post="/create/step/2" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="against_data">ğŸ¯ Decisione Contro Corrente</label>
            <p class="form-help">L'ultima volta che sei andato CONTRO i dati o il team</p>
            <textarea name="against_data" id="against_data" rows="6">{{ data.get('against_data', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="project_desc">ğŸ“– Progetto con Biforcazione</label>
            <textarea name="project_desc" id="project_desc" rows="6">{{ data.get('project_desc', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="worst_decision">ğŸ’€ Peggior Decisione</label>
            <textarea name="worst_decision" id="worst_decision" rows="4">{{ data.get('worst_decision', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 3 %}
    <!-- Step 3: Anti-Skills -->
    <h2 class="step-header">ğŸš« Step 3: Anti-Skills</h2>
    
    <form hx-post="/create/step/3" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="heresy">ğŸ”¥ Eresia Professionale</label>
            <textarea name="heresy" id="heresy" rows="5">{{ data.get('heresy', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="anti_skills">ğŸš« Cosa NON Fai</label>
            <textarea name="anti_skills" id="anti_skills" rows="5">{{ data.get('anti_skills', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="red_flags">ğŸš© Red Flags</label>
            <textarea name="red_flags" id="red_flags" rows="4">{{ data.get('red_flags', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 4 %}
    <!-- Step 4: Failure Museum -->
    <h2 class="step-header">ğŸ’€ Step 4: Failure Museum</h2>
    
    <form hx-post="/create/step/4" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="biggest_failure">ğŸ’¥ Fallimento Vero</label>
            <textarea name="biggest_failure" id="biggest_failure" rows="6">{{ data.get('biggest_failure', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="pattern_failure">ğŸ”„ Pattern di Errore</label>
            <textarea name="pattern_failure" id="pattern_failure" rows="4">{{ data.get('pattern_failure', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="belief_murdered">ğŸ’” Credenza Assassinata</label>
            <textarea name="belief_murdered" id="belief_murdered" rows="4">{{ data.get('belief_murdered', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 5 %}
    <!-- Step 5: Human Delta -->
    <h2 class="step-header">ğŸ¤– Step 5: Human Delta</h2>
    
    <form hx-post="/create/step/5" hx-target="main" hx-swap="innerHTML">
        <div class="form-row">
            <div class="form-group">
                <label for="ai_guilty">ğŸ˜… AI: Uso per...</label>
                <textarea name="ai_guilty" id="ai_guilty" rows="4">{{ data.get('ai_guilty', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="ai_better">ğŸ¤– AI meglio di me</label>
                <textarea name="ai_better" id="ai_better" rows="4">{{ data.get('ai_better', '') }}</textarea>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="ai_never">ğŸš« AI: Mai per...</label>
                <textarea name="ai_never" id="ai_never" rows="4">{{ data.get('ai_never', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="human_better">ğŸ§  Io meglio dell'AI</label>
                <textarea name="human_better" id="human_better" rows="4">{{ data.get('human_better', '') }}</textarea>
            </div>
        </div>
        
        <div class="form-group">
            <label for="delta_story">ğŸ“– Storia Delta</label>
            <textarea name="delta_story" id="delta_story" rows="5">{{ data.get('delta_story', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 6 %}
    <!-- Step 6: Curiosity Stack -->
    <h2 class="step-header">ğŸ“š Step 6: Curiosity Stack</h2>
    
    <form hx-post="/create/step/6" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="masterclass">ğŸ“ Masterclass Non-Lavorativa</label>
            <textarea name="masterclass" id="masterclass" rows="5">{{ data.get('masterclass', '') }}</textarea>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="books">ğŸ“š Libri formativi</label>
                <textarea name="books" id="books" rows="4">{{ data.get('books', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="people">ğŸ‘¤ Mentori</label>
                <textarea name="people" id="people" rows="4">{{ data.get('people', '') }}</textarea>
            </div>
        </div>
        
        <div class="form-group">
            <label for="rabbit_hole">ğŸ‡ Rabbit Hole Attuale</label>
            <textarea name="rabbit_hole" id="rabbit_hole" rows="4">{{ data.get('rabbit_hole', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 7 %}
    <!-- Step 7: Human API -->
    <h2 class="step-header">ğŸ§¬ Step 7: Human API</h2>
    
    <form hx-post="/create/step/7" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="communication">ğŸ’¬ Comunicazione</label>
            <textarea name="communication" id="communication" rows="4">{{ data.get('communication', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="crash_triggers">ğŸ’¥ Crash Triggers</label>
            <textarea name="crash_triggers" id="crash_triggers" rows="4">{{ data.get('crash_triggers', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="known_biases">âš ï¸ Bias Noti</label>
            <textarea name="known_biases" id="known_biases" rows="4">{{ data.get('known_biases', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="ideal_conditions">âœ¨ Condizioni Ideali</label>
            <textarea name="ideal_conditions" id="ideal_conditions" rows="4">{{ data.get('ideal_conditions', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 8 %}
    <!-- Step 8: What's Next -->
    <h2 class="step-header">ğŸš€ Step 8: What's Next</h2>
    
    <form hx-post="/create/step/8" hx-target="main" hx-swap="innerHTML">
        <div class="form-group">
            <label for="learning_next">ğŸ¯ Vuoi Imparare</label>
            <textarea name="learning_next" id="learning_next" rows="4">{{ data.get('learning_next', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="two_years">ğŸ”® Tra 2 Anni</label>
            <textarea name="two_years" id="two_years" rows="4">{{ data.get('two_years', '') }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="dream_project">ğŸŒŸ Progetto dei Sogni</label>
            <textarea name="dream_project" id="dream_project" rows="4">{{ data.get('dream_project', '') }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>
    
    {% elif step == 9 %}
    <!-- Step 9: Immagini (Facoltativo) -->
    <h2 class="step-header">ğŸ–¼ï¸ Step 9: Immagini Personali</h2>
    <p class="step-subtitle" style="color: var(--text-muted); margin-bottom: 1.5rem;">
        Facoltativo: Aggiungi foto personali, hobby, viaggi, progetti per arricchire visivamente il tuo Noofolio.
    </p>
    
    <form hx-post="/create/step/9" hx-target="main" hx-swap="innerHTML" enctype="multipart/form-data">
        <div class="form-group">
            <label>ğŸ“¸ Carica immagini (fino a 10)</label>
            <input type="file" name="images[]" multiple accept="image/*" 
                   style="padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); width: 100%;">
            <p class="form-help">
                Aggiungi foto di te, dei tuoi progetti, hobby, viaggi, workspace, ecc.<br>
                Formati: JPG, PNG, WebP. Max 10 immagini.
            </p>
        </div>
        
        <div class="form-group">
            <label for="images_description">Descrizione immagini (facoltativo)</label>
            <textarea name="images_description" id="images_description" rows="3" 
                      placeholder="Breve descrizione delle immagini caricate...">{{ data.get('images_description', '') }}</textarea>
        </div>
        
        <div class="encouragement-box">
            <h4>ğŸ’¡ Suggerimento</h4>
            <p>Le immagini renderanno il tuo Noofolio piÃ¹ personale e memorabile. Mostra chi sei oltre il lavoro!</p>
        </div>
        
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">ğŸš€ Genera Noofolio</button>
        </div>
    </form>

    {% elif step == 10 %}
    <!-- Step 10: Generation -->
    <h2 class="step-header">âœ¨ Generazione Noofolio</h2>
    
    {% if ready_to_generate %}
    <div id="generation-status">
        <div class="status-box">
            <p>â³ Preparazione...</p>
        </div>
    </div>
    
    <script>
    // Trigger generation
    fetch('/api/generate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = '/result/' + data.profile_id;
        } else {
            document.getElementById('generation-status').innerHTML = 
                '<div class="error-box"><p>âŒ Errore: ' + data.error + '</p></div>';
        }
    })
    .catch(error => {
        document.getElementById('generation-status').innerHTML = 
            '<div class="error-box"><p>âŒ Errore di rete</p></div>';
    });
    </script>
    {% endif %}
    
    {% endif %}
</div>
{% endblock %}