{% extends "base.html" %}

{% block extra_head %}
<style>
.creation-layout {
    display: flex;
    gap: 0;
    min-height: calc(100vh - 80px);
    margin: -2rem;
    margin-top: 0;
}

.step-sidebar {
    width: 280px;
    background: linear-gradient(180deg, rgba(99, 102, 241, 0.1) 0%, rgba(34, 211, 238, 0.05) 100%);
    border-right: 1px solid var(--border);
    padding: 2rem 1.5rem;
    position: sticky;
    top: 0;
    height: calc(100vh - 80px);
    overflow-y: auto;
}

.step-sidebar-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-dim);
    margin-bottom: 1.5rem;
    font-weight: 600;
}

.step-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.step-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s;
    position: relative;
}

.step-item.completed {
    background: rgba(34, 197, 94, 0.1);
    border-left: 3px solid var(--accent-green);
}

.step-item.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(34, 211, 238, 0.15));
    border-left: 3px solid var(--primary);
}

.step-item.pending {
    opacity: 0.5;
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--bg-card);
    border: 2px solid var(--border);
    font-size: 0.85rem;
    font-weight: 600;
    flex-shrink: 0;
}

.step-item.completed .step-number {
    background: var(--accent-green);
    border-color: var(--accent-green);
    color: white;
}

.step-item.active .step-number {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.step-info {
    flex: 1;
}

.step-title {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text);
    margin-bottom: 0.25rem;
}

.step-description {
    font-size: 0.75rem;
    color: var(--text-dim);
}

.step-content {
    flex: 1;
    padding: 2rem 3rem;
    overflow-y: auto;
    max-width: 900px;
}

@media (max-width: 1024px) {
    .step-sidebar {
        width: 200px;
        padding: 1.5rem 1rem;
    }
    .step-content {
        padding: 2rem 1.5rem;
    }
}

@media (max-width: 768px) {
    .creation-layout {
        flex-direction: column;
    }
    .step-sidebar {
        width: 100%;
        height: auto;
        position: relative;
        border-right: none;
        border-bottom: 1px solid var(--border);
    }
    .step-content {
        padding: 1.5rem 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="creation-layout">
    <!-- Step Sidebar -->
    <aside class="step-sidebar">
        <h3 class="step-sidebar-title">Creazione Noofolio</h3>
        <ul class="step-list">
            <li class="step-item {% if step == 1 %}active{% elif step > 1 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 1 %}âœ“{% else %}1{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Chi Sei</div>
                    <div class="step-description">Nome, CV, Links</div>
                </div>
            </li>
            <li class="step-item {% if step == 2 %}active{% elif step > 2 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 2 %}âœ“{% else %}2{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Decision Log</div>
                    <div class="step-description">Scelte chiave</div>
                </div>
            </li>
            <li class="step-item {% if step == 3 %}active{% elif step > 3 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 3 %}âœ“{% else %}3{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Anti-Skills</div>
                    <div class="step-description">Cosa NON fai</div>
                </div>
            </li>
            <li class="step-item {% if step == 4 %}active{% elif step > 4 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 4 %}âœ“{% else %}4{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Failure Museum</div>
                    <div class="step-description">I fallimenti</div>
                </div>
            </li>
            <li class="step-item {% if step == 5 %}active{% elif step > 5 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 5 %}âœ“{% else %}5{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Human Delta</div>
                    <div class="step-description">Tu vs AI</div>
                </div>
            </li>
            <li class="step-item {% if step == 6 %}active{% elif step > 6 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 6 %}âœ“{% else %}6{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Curiosity Stack</div>
                    <div class="step-description">Fonti di ispirazione</div>
                </div>
            </li>
            <li class="step-item {% if step == 7 %}active{% elif step > 7 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 7 %}âœ“{% else %}7{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Human API</div>
                    <div class="step-description">Manuale d'uso</div>
                </div>
            </li>
            <li class="step-item {% if step == 8 %}active{% elif step > 8 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 8 %}âœ“{% else %}8{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">What's Next</div>
                    <div class="step-description">Obiettivi futuri</div>
                </div>
            </li>
            <li class="step-item {% if step == 9 %}active{% elif step > 9 %}completed{% else %}pending{% endif %}">
                <span class="step-number">{% if step > 9 %}âœ“{% else %}9{% endif %}</span>
                <div class="step-info">
                    <div class="step-title">Immagini</div>
                    <div class="step-description">Gallery personale</div>
                </div>
            </li>
            <li class="step-item {% if step == 10 %}active{% else %}pending{% endif %}">
                <span class="step-number">10</span>
                <div class="step-info">
                    <div class="step-title">Generazione</div>
                    <div class="step-description">Creazione finale</div>
                </div>
            </li>
        </ul>
    </aside>

    <!-- Step Content -->
    <div class="step-content">

    {% if step == 1 %}
    <!-- Step 1: Chi Sei -->
    <h2 class="step-header">ðŸ“‹ Step 1: Chi Sei</h2>

    <div class="encouragement-box">
        <h4>âœ¨ Prima di iniziare...</h4>
        <p>Ci vorrÃ  pazienza ma ne varrÃ  la pena. I recruiter potranno chattare col tuo profilo.</p>
        <p style="margin-top: 1rem; padding: 0.75rem; background: rgba(99, 102, 241, 0.1); border-left: 3px solid var(--primary); border-radius: 4px; font-size: 0.9rem;">
            â­ï¸ <strong>Ricorda:</strong> Tutte le domande sono facoltative! Puoi skippare e andare avanti. PiÃ¹ rispondi, migliore sarÃ  il risultato.
        </p>
    </div>

    <form hx-validate="true" hx-post="/create/step/1" hx-target=".creation-layout" hx-swap="outerHTML" enctype="multipart/form-data">
        <div class="form-row">
            <div class="form-group">
                <label for="nome">Nome *</label>
                <input type="text" name="nome" id="nome" required value="{{ data.get('nome', '') }}">
            </div>
            <div class="form-group">
                <label for="cognome">Cognome *</label>
                <input type="text" name="cognome" id="cognome" required value="{{ data.get('cognome', '') }}">
            </div>
        </div>

        <!-- CV Section with 3 options -->
        <div class="form-group">
            <label>ðŸ“„ CV / Background *</label>
            <div class="cv-options" style="margin-top: 0.5rem;">
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="upload" onchange="toggleCVInput('upload')">
                        <span>Allega file (PDF/Word)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="link" onchange="toggleCVInput('link')">
                        <span>Link condiviso</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="radio" name="cv_type" value="text" checked onchange="toggleCVInput('text')">
                        <span>Incolla testo</span>
                    </label>
                </div>

                <div id="cv-upload" style="display: none;">
                    <input type="file" name="cv_file" accept=".pdf,.doc,.docx"
                           style="padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); width: 100%;">
                    <p class="form-help">Formati supportati: PDF, Word (.doc, .docx)</p>
                </div>

                <div id="cv-link" style="display: none;">
                    <input type="url" name="cv_link" placeholder="https://drive.google.com/... o OneDrive/Dropbox link"
                           style="width: 100%; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <p class="form-help">Link condiviso da Google Drive, OneDrive, Dropbox, ecc.</p>
                </div>

                <div id="cv-text" style="display: block;">
                    <textarea name="cv_content" rows="8"
                              placeholder="Incolla qui il testo del tuo CV o descrivi il tuo background professionale...">{{ data.get('cv_content', '') }}</textarea>
                </div>
            </div>
        </div>

        <!-- Links Section (Dynamic) -->
        <div class="form-group">
            <label>ðŸ”— Link professionali</label>
            <p class="form-help">Aggiungi LinkedIn, GitHub, Behance, Articoli, Portfolio, ecc.</p>

            <div id="links-container">
                <!-- Default 2 rows -->
                <div class="link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="url" name="link_url[]" placeholder="https://linkedin.com/in/..."
                           style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <select name="link_type[]"
                            style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="GitHub">GitHub</option>
                        <option value="Behance">Behance</option>
                        <option value="Articolo">Articolo</option>
                        <option value="Altro">Altro</option>
                    </select>
                    <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
                </div>

                <div class="link-row" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="url" name="link_url[]" placeholder="https://github.com/..."
                           style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                    <select name="link_type[]"
                            style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="GitHub" selected>GitHub</option>
                        <option value="Behance">Behance</option>
                        <option value="Articolo">Articolo</option>
                        <option value="Altro">Altro</option>
                    </select>
                    <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
                </div>
            </div>

            <button type="button" onclick="addLink()" class="btn btn-secondary" style="margin-top: 0.5rem;">
                âž• Aggiungi link
            </button>
        </div>

        <div class="form-group">
            <label for="superpotere">âš¡ Superpotere</label>
            <p class="form-help">Se i tuoi amici o i tuoi colleghi ti definissero un supereroe, quale sarebbe il tuo superpotere?</p>
            <textarea name="superpotere" id="superpotere" rows="3"
                      placeholder='Es: "Sono quello che trova il bug impossibile" oppure "Riesco a semplificare idee complesse"'>{{ data.get('superpotere', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="presentazione">ðŸ’¬ Presentazione</label>
            <textarea name="presentazione" id="presentazione" rows="3">{{ data.get('presentazione', '') }}</textarea>
        </div>

        <div class="form-actions">
            <a href="/" class="btn btn-secondary">â† Home</a>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    <script>
    function toggleCVInput(type) {
        const cvText = document.querySelector('[name="cv_content"]');
        const cvFile = document.querySelector('[name="cv_file"]');
        const cvLink = document.querySelector('[name="cv_link"]');
        
        document.getElementById('cv-upload').style.display = type === 'upload' ? 'block' : 'none';
        document.getElementById('cv-link').style.display = type === 'link' ? 'block' : 'none';
        document.getElementById('cv-text').style.display = type === 'text' ? 'block' : 'none';
        
        // Gestisci required dinamicamente
        if (type === 'text') {
            cvText.required = true;
            if (cvFile) cvFile.required = false;
            if (cvLink) cvLink.required = false;
        } else if (type === 'upload') {
            cvText.required = false;
            if (cvFile) cvFile.required = true;
            if (cvLink) cvLink.required = false;
        } else if (type === 'link') {
            cvText.required = false;
            if (cvFile) cvFile.required = false;
            if (cvLink) cvLink.required = true;
        }
    }


    function addLink() {
        const container = document.getElementById('links-container');
        const newRow = document.createElement('div');
        newRow.className = 'link-row';
        newRow.style.cssText = 'display: flex; gap: 0.5rem; margin-bottom: 0.5rem;';
        newRow.innerHTML = `
            <input type="url" name="link_url[]" placeholder="https://..."
                   style="flex: 2; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
            <select name="link_type[]"
                    style="flex: 1; padding: 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text);">
                <option value="LinkedIn">LinkedIn</option>
                <option value="GitHub">GitHub</option>
                <option value="Behance">Behance</option>
                <option value="Articolo">Articolo</option>
                <option value="Altro">Altro</option>
            </select>
            <button type="button" onclick="removeLink(this)" class="btn-icon" style="padding: 0.75rem; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">âœ•</button>
        `;
        container.appendChild(newRow);
    }

    function removeLink(button) {
        button.parentElement.remove();
    }
    </script>

    {% elif step == 2 %}
    <!-- Step 2: Decision Log -->
    <h2 class="step-header">ðŸŒ³ Step 2: Decision Log</h2>

    <form hx-validate="true" hx-post="/create/step/2" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="against_data">ðŸŽ¯ Decisione Contro Corrente</label>
            <p class="form-help">L'ultima volta che sei andato CONTRO i dati o il team</p>
            <textarea name="against_data" id="against_data" rows="6">{{ data.get('against_data', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="project_desc">ðŸ“– Progetto con Biforcazione</label>
            <textarea name="project_desc" id="project_desc" rows="6">{{ data.get('project_desc', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="worst_decision">ðŸ’€ Peggior Decisione</label>
            <textarea name="worst_decision" id="worst_decision" rows="4">{{ data.get('worst_decision', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 3 %}
    <!-- Step 3: Anti-Skills -->
    <h2 class="step-header">ðŸš« Step 3: Anti-Skills</h2>

    <form hx-validate="true" hx-post="/create/step/3" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="heresy">ðŸ”¥ Eresia Professionale</label>
            <textarea name="heresy" id="heresy" rows="5">{{ data.get('heresy', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="anti_skills">ðŸš« Cosa NON Fai</label>
            <textarea name="anti_skills" id="anti_skills" rows="5">{{ data.get('anti_skills', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="red_flags">ðŸš© Red Flags</label>
            <textarea name="red_flags" id="red_flags" rows="4">{{ data.get('red_flags', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 4 %}
    <!-- Step 4: Failure Museum -->
    <h2 class="step-header">ðŸ’€ Step 4: Failure Museum</h2>

    <form hx-validate="true" hx-post="/create/step/4" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="biggest_failure">ðŸ’¥ Fallimento Vero</label>
            <textarea name="biggest_failure" id="biggest_failure" rows="6">{{ data.get('biggest_failure', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="pattern_failure">ðŸ”„ Pattern di Errore</label>
            <textarea name="pattern_failure" id="pattern_failure" rows="4">{{ data.get('pattern_failure', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="belief_murdered">ðŸ’” Credenza Assassinata</label>
            <textarea name="belief_murdered" id="belief_murdered" rows="4">{{ data.get('belief_murdered', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 5 %}
    <!-- Step 5: Human Delta -->
    <h2 class="step-header">ðŸ¤– Step 5: Human Delta</h2>

    <form hx-validate="true" hx-post="/create/step/5" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-row">
            <div class="form-group">
                <label for="ai_guilty">ðŸ˜… AI: Uso per...</label>
                <textarea name="ai_guilty" id="ai_guilty" rows="4">{{ data.get('ai_guilty', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="ai_better">ðŸ¤– AI meglio di me</label>
                <textarea name="ai_better" id="ai_better" rows="4">{{ data.get('ai_better', '') }}</textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="ai_never">ðŸš« AI: Mai per...</label>
                <textarea name="ai_never" id="ai_never" rows="4">{{ data.get('ai_never', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="human_better">ðŸ§  Io meglio dell'AI</label>
                <textarea name="human_better" id="human_better" rows="4">{{ data.get('human_better', '') }}</textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="delta_story">ðŸ“– Storia Delta</label>
            <textarea name="delta_story" id="delta_story" rows="5">{{ data.get('delta_story', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 6 %}
    <!-- Step 6: Curiosity Stack -->
    <h2 class="step-header">ðŸ“š Step 6: Curiosity Stack</h2>

    <form hx-validate="true" hx-post="/create/step/6" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="masterclass">ðŸŽ“ Masterclass Non-Lavorativa</label>
            <textarea name="masterclass" id="masterclass" rows="5">{{ data.get('masterclass', '') }}</textarea>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="books">ðŸ“š Libri formativi</label>
                <textarea name="books" id="books" rows="4">{{ data.get('books', '') }}</textarea>
            </div>
            <div class="form-group">
                <label for="people">ðŸ‘¤ Mentori</label>
                <textarea name="people" id="people" rows="4">{{ data.get('people', '') }}</textarea>
            </div>
        </div>

        <div class="form-group">
            <label for="rabbit_hole">ðŸ‡ Rabbit Hole Attuale</label>
            <textarea name="rabbit_hole" id="rabbit_hole" rows="4">{{ data.get('rabbit_hole', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 7 %}
    <!-- Step 7: Human API -->
    <h2 class="step-header">ðŸ§¬ Step 7: Human API</h2>

    <form hx-validate="true" hx-post="/create/step/7" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="communication">ðŸ’¬ Comunicazione</label>
            <textarea name="communication" id="communication" rows="4">{{ data.get('communication', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="crash_triggers">ðŸ’¥ Crash Triggers</label>
            <textarea name="crash_triggers" id="crash_triggers" rows="4">{{ data.get('crash_triggers', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="known_biases">âš ï¸ Bias Noti</label>
            <textarea name="known_biases" id="known_biases" rows="4">{{ data.get('known_biases', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="ideal_conditions">âœ¨ Condizioni Ideali</label>
            <textarea name="ideal_conditions" id="ideal_conditions" rows="4">{{ data.get('ideal_conditions', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 8 %}
    <!-- Step 8: What's Next -->
    <h2 class="step-header">ðŸš€ Step 8: What's Next</h2>

    <form hx-validate="true" hx-post="/create/step/8" hx-target=".creation-layout" hx-swap="outerHTML">
        <div class="form-group">
            <label for="learning_next">ðŸŽ¯ Vuoi Imparare</label>
            <textarea name="learning_next" id="learning_next" rows="4">{{ data.get('learning_next', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="two_years">ðŸ”® Tra 2 Anni</label>
            <textarea name="two_years" id="two_years" rows="4">{{ data.get('two_years', '') }}</textarea>
        </div>

        <div class="form-group">
            <label for="dream_project">ðŸŒŸ Progetto dei Sogni</label>
            <textarea name="dream_project" id="dream_project" rows="4">{{ data.get('dream_project', '') }}</textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">Avanti â†’</button>
        </div>
    </form>

    {% elif step == 9 %}
    <!-- Step 9: Immagini (Facoltativo) -->
    <h2 class="step-header">ðŸ–¼ï¸ Step 9: Immagini Personali</h2>
    <p class="step-subtitle" style="color: var(--text-muted); margin-bottom: 1.5rem;">
        Facoltativo: Aggiungi foto personali, hobby, viaggi, progetti per arricchire visivamente il tuo Noofolio.
    </p>

    <form hx-validate="true" hx-post="/create/step/9" hx-target=".creation-layout" hx-swap="outerHTML" enctype="multipart/form-data">
        <div class="form-group">
            <label>ðŸ“¸ Carica immagini (fino a 10)</label>
            <input type="file" name="images[]" multiple accept="image/*"
                   style="padding: 0.5rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; color: var(--text); width: 100%;">
            <p class="form-help">
                Aggiungi foto di te, dei tuoi progetti, hobby, viaggi, workspace, ecc.<br>
                Formati: JPG, PNG, WebP. Max 10 immagini.
            </p>
        </div>

        <div class="form-group">
            <label for="images_description">Descrizione immagini (facoltativo)</label>
            <textarea name="images_description" id="images_description" rows="3"
                      placeholder="Breve descrizione delle immagini caricate...">{{ data.get('images_description', '') }}</textarea>
        </div>

        <div class="encouragement-box">
            <h4>ðŸ’¡ Suggerimento</h4>
            <p>Le immagini renderanno il tuo Noofolio piÃ¹ personale e memorabile. Mostra chi sei oltre il lavoro!</p>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="history.back()">â† Indietro</button>
            <button type="submit" class="btn btn-primary">ðŸš€ Genera Noofolio</button>
        </div>
    </form>

    {% elif step == 10 %}
    <!-- Step 10: Generation -->
    <h2 class="step-header">âœ¨ Generazione Noofolio</h2>

    {% if ready_to_generate %}
    <div id="generation-status">
        <div class="status-box">
            <p>â³ Preparazione...</p>
        </div>
    </div>

    <script>
    // Trigger generation
    fetch('/api/generate', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            window.location.href = '/result/' + data.profile_id;
        } else {
            document.getElementById('generation-status').innerHTML =
                '<div class="error-box"><p>âŒ Errore: ' + data.error + '</p></div>';
        }
    })
    .catch(error => {
        document.getElementById('generation-status').innerHTML =
            '<div class="error-box"><p>âŒ Errore di rete</p></div>';
    });
    </script>
    {% endif %}

    {% endif %}

    </div><!-- end step-content -->
</div><!-- end creation-layout -->
{% endblock %}